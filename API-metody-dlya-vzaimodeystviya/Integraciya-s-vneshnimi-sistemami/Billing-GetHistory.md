# Billing.GetHistory

## Описание

Метод предназначен для получения истории действий над объектами за заданный период (DateFrom-DateTo).

В результате метода приходит список записей в виде RecordSet, запись – информация об одном действии, где есть сведения о названии, параметрах, времени и объекта действия.

Не дает результата для пользователей офисов Тензора, за исключением пользователей с правами "Администратор".

Результат лимитирован размером максимум в 1000 записей за один запрос. Лимит не изменяется.

В параметр PointSale допускается указание кода точки продаж, которая доступна в иерархии для текущего пользователя, иначе метод ничего не возвращает. Если в параметр передан NULL, точка продаж определяется от пользователя, под которым был вызван метод.

Параметр SubPoints определяет необходимо ли выдать историю по субточкам: TRUE – по точке продаж + по субточкам, FALSE – только по точке продаж. Точка продаж определяется параметром PointSale.

## Параметры

| Название     | Тип          | Описание |
|--------------|--------------|----------|
| DateFrom    | Дата        | Дата начала периода |
| DateTo      | Дата        | Дата конца периода |
| PointSale   | Строка      | Код точки продаж, для которой необходимо получить историю<br><br>Если параметр пустой (NULL), точка продаж определяется от текущего пользователя |
| SubPoints   | Логический  | True - история по точке продаж пользователя + история по субточкам,<br>False - история только по точке продаж пользователя |
| Actions     | Массив строк (необязательный) | Фильтрация результата по названию действия |
| NavigationKey | Строка    | Ключ навигации<br><br>Используется для постраничной навигации: при первом запросе передается NULL, при следующих - значение NavigationKey из любой записи результата предыдущего запроса |

## Результат

Список записей (RecordSet).

| Поле         | Тип           | Описание |
|--------------|---------------|----------|
| Object      | Строка       | Название объекта (Аккаунт, Контрагент) |
| Id          | Число целое  | Идентификатор объекта |
| DateTime    | Дата и время | Время совершенного действия |
| Action      | Строка       | Наименование действия |
| Data        | JSON         | Параметры действия (в формате JSON) |
| PointSale   | Строка       | Код точки продаж, для которой была сформирована запись |
| NavigationKey | Строка     | Ключ навигации |

## Примеры вызова (JSON-RPC)

### Пример 1

```json
{
    "jsonrpc": "2.0",
    "method": "Billing.GetHistory",
    "params": {
        "PointSale": "0240",
        "DateFrom": "2018-11-26",
        "DateTo": "2018-11-28",
        "SubPoints": false,
        "NavigationKey": null
    },
    "protocol": 2,
    "id": 0
}
```

### Пример 2

```json
{
    "jsonrpc": "2.0",
    "method": "Billing.GetHistory",
    "params": {
        "PointSale": "0240",
        "DateFrom": "2018-11-26",
        "DateTo": "2018-11-28",
        "SubPoints": false,
        "Actions": ["Активность контрагента", "Реквизиты и контакты"],
        "NavigationKey": null
    },
    "protocol": 2,
    "id": 0
}
```

## Примеры вызова метода из консоли браузера

### Пример 1

```javascript
requirejs(['Types/source'], function(blo){
    new blo.SbisService({
        endpoint: {
            contract: 'Billing',
            address: '/partner_api/service/sbis-rpc-service300.dll'
        }
    }).call(
        'GetHistory', 
        {
            "PointSale": "0240",
            "DateFrom": "2018-11-26",
            "DateTo": "2018-11-28",
            "SubPoints": false,
            "NavigationKey": null
        }
    )
});
```

### Пример 2

```javascript
requirejs(['Types/source'], function(blo){
    new blo.SbisService({
        endpoint: {
            contract: 'Billing',
            address: '/partner_api/service/sbis-rpc-service300.dll'
        }
    }).call(
        'GetHistory', 
        {
            "PointSale": "0240",
            "DateFrom": "2018-11-26",
            "DateTo": "2018-11-28",
            "SubPoints": false,
            "Actions": ["Активность контрагента", "Реквизиты и контакты"],
            "NavigationKey": null
        }
    )
});