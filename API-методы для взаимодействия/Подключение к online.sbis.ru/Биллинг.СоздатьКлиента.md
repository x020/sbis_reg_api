# Биллинг.СоздатьКлиента

## Внимание

Метод должен быть вызван по адресу https://online.sbis.ru/reg/service/ (адрес для тестирования - https://fix-online.sbis.ru/reg/service/), передача идентификатора сессии не требуется.

## Описание

Функция завершает регистрацию клиента в облаке online.sbis.ru: создаёт пользователя с правами администратора с указанными логином и паролем (если они были заданы), прикрепляет сертификат (если он был передан). В Биллинге при этом появляется организация с указанными ИНН и КПП (если её не было ранее), создаётся аккаунт для неё (если он не был создан ранее). После первого входа клиента на online.sbis.ru по логину и паролю или сертификату аккаунт в Биллинге помечается авторизованным, а в личном кабинете клиента на online.sbis.ru появляется список наших организаций, среди них – та, реквизиты который были указаны в параметрах данного метода или при создании приглашения.

Есть два способа вызова функции Биллинг.СоздатьКлиента:

1. В параметре «ИдПриглашения» передать хэш ранее созданного приглашения, в параметре «Запись» должны быть заполнены поля «Логин», «Пароль» и/или «Сертификат» вместо этих двух полей.
2. В параметре «ИдПриглашения» передать пустую строку (случай регистрации без приглашения), в параметре «Запись» должны быть заполнены поля «ИНН», «КПП» (для ЮЛ), «Сертификат», также могут быть переданы поля «Логин» и «Пароль».

Если среди параметров (полей записи) указаны логин и пароль, то пользователь сможет войти в свой кабинет на online.sbis.ru, используя эти логин и пароль, если указан сертификат, пользователь сможет пройти аутентификацию по сертификату для входа в кабинет. Если указаны все три параметра, пользователь может выбрать любой способ.

Метод может вернуть ошибку в качестве результата в следующих случаях:

- Если выполняется регистрация по сертификату без приглашения и подключаемый контрагент уже подключен к ЭДО.
- Если выполняется регистрация по приглашению и без сертификата и аккаунт, для которого было создано приглашение, уже авторизован.
- Если выполняется регистрация по приглашению и сертификату, аккаунт, для которого было создано приглашение, уже авторизован, и подключаемый контрагент подключен к ЭДО.

В том случае, если в состав записи «Реквизиты» входит заполненное поле «КодПартнера», то:

- аккаунт, выбранный для регистрации, будет перезакреплён за подразделением с переданным кодом, если он не является платным (т.е. у него нет платной лицензии);
- подключаемый контрагент, реквизиты которого были переданы в параметрах, будет перезакреплён за подразделением с переданным кодом, если он не входит в состав ни одного платного аккаунта.

## Параметры

| Название       | Тип          | Описание                                                                 |
|----------------|--------------|--------------------------------------------------------------------------|
| ИдПриглашения | Строка (UUID) | Идентификатор приглашения, созданного ранее для данного клиента         |
| Запись        | Запись       | Реквизиты подключаемого клиента, формат см. ниже                         |

## Содержимое параметра Запись

| Название          | Тип    | Описание                                                                 |
|-------------------|--------|--------------------------------------------------------------------------|
| Логин            | Строка | Логин для входа в online.sbis.ru                                         |
| Пароль           | Строка | Пароль для входа в online.sbis.ru (в незашифрованном виде)               |
| Сертификат       | Строка | Файл сертификата, который предполагается использовать для подписи электронных документов, преобразованный в ASCII-строку с помощью системы кодирования Base64 |
| ИНН              | Строка | ИНН подключаемого контрагента                                            |
| КПП              | Строка | КПП подключаемого контрагента (для ИП должен отсутствовать или быть пустым) |
| КодПартнера      | Строка | Код офиса партнера, состоящий из 4-х или 5-ти цифр, необходим для последующего закрепления клиента за переданным партнёром |
| ИдентификаторАкции | Строка | Идентификатор акции, в рамках которой выполняется регистрация            |

## Результат

Идентификатор аккаунта.

## Пример вызова

```json
{
    "jsonrpc": "2.0",
    "method": "Биллинг.СоздатьКлиента",
    "params": {
        "ИдПриглашения": "",
        "Запись": {
            "s": {
                "ИНН": "Строка",
                "КПП": "Строка",
                "Сертификат": "Строка",
                "КодПартнера": "Строка"
            },
            "d": {
                "ИНН": "1215107651",
                "КПП": "121501001",
                "Сертификат": "MIIJGjCCCMmg...YFB",
                "КодПартнера": "7705"
            }
        }
    },
    "protocol": 2,
    "id": 0
}