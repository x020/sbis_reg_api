# Формат протокола JSON-RPC

## Общие сведения

### Соответствие стандарту JSON-RPC v2.0

Протокол передачи между клиентом и сервером, использующий JSON-формат, поддерживает спецификацию JSON-RPC v2.0 и соответствует данному стандарту. Все дополнительные типы данных описываются отдельно, дополняя существующие в спецификации типы данных.

#### Объект запроса в JSON-RPC v2.0

Согласно стандарту JSON-объект запроса должен содержать:

- значение "jsonrpc": "2.0", указывающее на версию спецификации JSON-RPC;
- параметр method с названием метода бизнес-логики;
- параметр params с объектом передаваемых параметров;
- параметр id со строковым значением, которое может интерпретироваться на клиенте.

Также JSON-объект запроса для использования в СБИС 3 должен содержать значение protocol – целое значение версии протокола представления дополнительных внутренних типов СБИС 3 в виде JSON-объектов. Для вызова методов данного API рекомендуется использовать значение 2 данного параметра: "protocol": 2.

#### Объект ответа в JSON-RPC v2.0

Согласно стандарту JSON-объект ответа должен содержать значение "jsonrpc": "2.0", указывающее на версию спецификации JSON-RPC, а также параметр id со строковым значением, аналогично объекту запроса. Также в ответе присылается protocol – версия представления внутренних типов СБИС 3 в JSON-RPC.

Если произошла ошибка, в JSON-объекте ответа должно появиться значение error, которое будет описано дальше. Если метод выполнился успешно, в JSON-объекте ответа появится значение result со значением, которое вернул метод. В отличие от error, значение result не имеет чёткого формата и зависит от того, что вернул метод. Например, если метод вернул null, то в JSON-объекте ответа появится "result": null.

#### Объект ошибки в JSON-RPC v2.0

Объект ошибки содержит следующие поля:

- code – целочисленный код ошибки;
- message – текстовое сообщение об ошибке.

## Сериализация типов в JSON-формат

### Скалярные типы в JSON-RPC v2.0

Все типы скаляров представляются согласно спецификации JSON-RPC v2.0:

- целые числа – в десятичном представлении, например: -10, 5, 0, 100;
- вещественные числа – в виде десятичной дроби, например: 3.14, 1.024, 3.333;
- текстовые строки – в обрамлении кавычками, например: "строка", "текст";
- логические значения – истинность в виде true или false, без кавычек;
- пустое значение – значение null, без кавычек.

### Массивы и объекты в JSON-RPC v2.0

Все массивы представляются в виде перечисления элементов в квадратных скобках через запятую, например: [] – пустой массив, ["a","b","c"] – массив строк или [1.0, "строка", null, {"key": 123}] – массив разнородных элементов.

Все объекты представляются в виде перечисления пар ключ: значение, где ключ – строковая константа, а значением может быть произвольное значение любого типа, например: {} – пустой объект, {"a": null,"b": 123,"c": [false, true]} – объект с разнородными значениями.

### RecordSet – выборка данных в JSON-RPC для СБИС 3

Результат может быть возвращён в виде таблицы значений. Такой результат называется выборкой или списком записей. Ниже дается описание выборки для "protocol": 2 – 2-й версии протокола:

```json
{
    "s": [<формат выборки в виде массива форматов полей>],
    "d": [<список массивов значений>]
}
```

О формате каждого типа поля будет подробно написано ниже, в целом это простые JSON-объекты такого типа:

```json
{
    "n": "@Документ",
    "t": "Число целое"
}
```

Пример сериализованной выборки в версии "protocol": 2 протокола JSON-RPC v2.0:

```json
{
    "s": [
        {"n": "ServiceID", "t": "Строка"}, 
        {"n": "ServiceCount","t": "Числоцелое"},
        {"n":"ServiceCost","t":"Деньги"}
    ],
    "d": [
        ["EOpSBISfrmUo", 1,4700.00],
        ["EOpNI", 2, 1200.00],
        ["EO_null_online", 1, 500.00]
    ]
}
```

### Record – запись в выборке данных в JSON-RPC для СБИС 3

В версии "protocol": 2 запись в JSON выглядит так:

```json
{
    "s": <объект вида {
        <имя поля>: <формат поля>
    },
    "d": <объект вида {
        <имя поля>: <значение>
    }
}
```

Пример сериализованной записи:

```json
{
    "s": {
        "INN": "Строка",
        "KPP": "Строка",
        "Name": "Строка"
    },
    "d": {
        "INN": "6449058159",
        "KPP": "644901001",
        "Name": "ЕВРО-ЗАПЧАСТЬ, ООО"
    }
}
```

## Типы данных

В ниже расположенной таблице приведены правила и примеры представления типов данных, которые используются в данном API. Эти правила необходимо соблюдать при формировании JSON-запроса к сервису Биллинга.

| Тип          | Формат                          | Пример     |
|--------------|---------------------------------|------------|
| Строка      | "xxx"                           | "абв"     |
| Число целое | dd..d                           | 1250      |
| Логическое  | false или true                  | True      |
| Дата        | "ГГГГ-ММ-ДД"                    | "2014-07-29" |
| Дата и время| "ГГГГ-ММ-ДД чч:мм:сс"           | "2014-07-29 16:10:25" |
| Денежный (деньги) | xx..x.yy (с указанием дробной части) или xx..x (без дробной части) | 1520.50 |

Null-значение внутри JSON-запроса должно быть представлено как null (без кавычек).