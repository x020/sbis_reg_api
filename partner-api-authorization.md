# Аутентификация

Для успешного вызова методов настоящего API клиент должен быть авторизован.

Для того, чтобы пройти авторизацию, необходимо вызвать метод **САП.Аутентифицировать** на сервисе [https://reg.tensor.ru/auth/service/](https://reg.tensor.ru/auth/service/), передав ему на вход логин и пароль. Подробности о формате запросов см. в [Формат протокола JSON-RPC](partner-api-data.md).

## Пример авторизации

### Заголовки запроса
- **POST** https://reg.tensor.ru/auth/service/ HTTP/1.1
- **Host**: reg.tensor.ru
- **Content-Type**: application/json-rpc; charset=utf-8
- **Accept**: application/json-rpc

### Запрос
```json
{
    "jsonrpc": "2.0",
    "method": "САП.Аутентифицировать",
    "params": {
        "login": "login_example",
        "password": "pass_example"
    },
    "protocol": 2,
    "id": 0
}
```

### Ответ
```json
{
    "jsonrpc": "2.0",
    "result": "0000dabd-0000df57-00ba-cccfbad103c84156",
    "id": 0,
    "protocol": 2
}
```

Полученный идентификатор сессии (указанный в параметре result ответа) необходимо запомнить и передавать как значение поля заголовка с названием **«X-SBISSessionID»** для последующих вызовов остальных методов данного API.

Получать идентификатор сессии описанным выше образом необходимо в тех случаях, когда информация о предыдущем идентификаторе не сохранилась (отсутствует) или идентификатор перестал быть действительным (истекло время жизни сессии).

Время жизни сессии – 1 сутки с момента последнего обращения к сервису с данным идентификатором сессии.

Для проверки действительности текущей сессии достаточно вызвать целевой API-метод: если будет получена ошибка с кодом 401, нужно получить новую сессию.

> **Важно!**  
> Не рекомендуется получать новую сессию перед каждым вызовом какого-либо целевого метода, в этом случае возможна блокировка учётной записи!

Передаваемый клиентом идентификатор сессии служит для опознавания (идентификации) пользователя системы и определения множества методов, вызов которого ему (пользователю) разрешён.

Для аутентификации желательно использовать данные учётной записи (логин и пароль) реального пользователя, за которым должны закрепляться создаваемые объекты (аккаунты, контрагенты, лицензии и прочие). При использовании такого подхода процедуру аутентификации должен проходить каждый пользователь, работающий с сервисом Биллинга посредством данного API, для каждого из них необходимо запомнить полученный идентификатор сессии.

Менее предпочтительным подходом является использование одной учётной записи для всех пользователей. Однако, в данном случае создаваемые аккаунты, контрагенты и прочие объекты будут закрепляться именно за пользователем с данной учётной записью.

## Пример вызова метода с передачей идентификатора сессии

### Заголовки запроса
- **POST**: [https://reg.tensor.ru/partner_api/service/](https://reg.tensor.ru/partner_api/service/) HTTP/1.1
- **Host**: reg.tensor.ru
- **Content-Type**: application/json-rpc; charset=utf-8
- **Accept**: application/json-rpc
- **X-SBISSessionID**: 0000dabd-0000df57-00ba-cccfbad103c84156

### Запрос
```json
{
    "jsonrpc": "2.0",
    "method": "Contractor.InfoByID",
    "params": {
        "ContractorID": 12345
    },
    "protocol": 2,
    "id": 0
}
```

### Ответ
```json
{
    "jsonrpc": "2.0",
    "result": {
        "s": {
            "INN": "Строка",
            "Name": "Строка",
            ...
        },
        "d": {
            "INN": "1234567894",
            "Name": "Организация",
            ...
        }
    },
    "id": 0,
    "protocol": 2
}
```

Если при вызове методов данного API за исключением метода «САП.Аутентифицировать» в заголовке не будет передаваться поле «X-SBISSessionID» (или его содержимое будет устаревшим), сервер вернёт http-ответ с кодом «401 Unauthorized».